document.addEventListener("DOMContentLoaded",async function(){if(window.__PIXEL_LOADED__)return;if(window.__PIXEL_LOADED__=!0,"undefined"==typeof window)return;const e="http://localhost:3000/api/pixel",t=document.currentScript;var n=[];if(!t)return;const o=t.getAttribute("data-websiteid");if(!o||"string"!=typeof o)return;let i=performance.now(),a=0;const c=new URLSearchParams(location.search),r=c.get("utm_source"),s=c.get("utm_campaign"),p=history.pushState,d=history.replaceState,h=(e,t)=>JSON.stringify({type:e.toUpperCase(),screenWidth:window.innerWidth,website_id:o,url:location.href,utm_campaign:s,utm_source:r,...t});if(!(await fetch(e+"/session?id="+o,{method:"POST",body:h("session"),headers:{"Content-Type":"application/json"},keepalive:!0})).ok)return;const l=(t,n,o)=>{const i=h(t,n);o?fetch(e+"/collect",{method:"POST",body:h(t,n),headers:{"Content-Type":"application/json"},keepalive:!0}).catch(()=>{}):navigator.sendBeacon?navigator.sendBeacon(e+"/collect",i):fetch(e+"/collect",{method:"POST",body:h(t,n),headers:{"Content-Type":"application/json"},keepalive:!0}).catch(()=>{})},u=()=>{n.push(location.href),n.length>=5&&(l("path_change",{path_history:n}),n=[])};history.pushState=function(...e){p.apply(this,e),u()},history.replaceState=function(...e){d.apply(this,e),u()},l("page_view"),window.addEventListener("popstate",u),window.addEventListener("pagehide",()=>{console.log(n),a+=performance.now()-i,l("page_exit",{active_time:Math.round(a),path_history:n})})}());